<script src="js/papaparse.min.js"></script>

<div class="alert alert-info alert-dismissible" role="alert">
    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    Select your CSV files for upload. This tool will parse your files and guide you through the process of defining a property graph data model and import your data into Neo4j.
</div>

<h1>Select file(s)</h1>

<input type="file" id="csv-file" name="files" multiple/>


<script>
    var fileData = {},
        fileNames = [];

    function handleFileSelect(evt) {
        var file = evt.target.files[0];

        $('#csv-file').parse({
            config: {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                //preview: 100,
                complete: function(results, file) {
                    var data = results;

                    fileData[file.name] = data;
                    fileNames.push(file.name);
                }
            },
            before: function(file, inputElem) {
                console.log(file);
            },
            complete: function() {

                fileData['files'] = fileNames;
                $.ajax({
                    type: 'POST',
                    data: JSON.stringify(fileData),
                    contentType: 'application/json',
                    url: '/load',
                    success: function(data) {
                        console.log('success');
                        window.location.href = '/load2';
                    }

                });
            }
        });
    }

    $(document).ready(function(){
        $("#csv-file").change(handleFileSelect);
    })
</script>